---
# chiffon:service={{ service_name }}
# chiffon:description={{ description }}
# Generated by Chiffon Infrastructure Agent
# Template version: 1.0

- name: Deploy {{ service_name | title }}
  hosts: {{ hosts | default('all') }}
  become: {{ become | default('yes') }}
  vars:
    service_name: "{{ service_name }}"
    service_port: {{ service_port | default(8080) }}
    service_user: "{{ service_user | default(service_name) }}"
    service_group: "{{ service_group | default(service_name) }}"
    config_dir: "/etc/{{ service_name }}"
    data_dir: "/var/lib/{{ service_name }}"
    log_dir: "/var/log/{{ service_name }}"

  pre_tasks:
    - name: Verify target connectivity
      ansible.builtin.ping:
      tags:
        - always

  roles:
    - role: {{ service_name }}
      tags:
        - {{ service_name }}
        - deploy

  post_tasks:
    - name: Verify {{ service_name }} is running
      ansible.builtin.service:
        name: "{{ service_name }}"
        state: started
      register: service_status
      ignore_errors: yes
      tags:
        - verify
